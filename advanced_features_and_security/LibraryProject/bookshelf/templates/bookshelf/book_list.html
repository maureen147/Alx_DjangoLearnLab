<!DOCTYPE html>
<html>
<head>
    <title>Book List</title>
    <!-- Basic Content Security Policy meta tag -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self';">
</head>
<body>
    <h1>Book List</h1>
    
    {% if perms.bookshelf.can_create %}
    <p><a href="{% url 'bookshelf:add_book' %}">Add New Book</a></p>
    {% endif %}
    
    <!-- Secure search form -->
    <form method="get" action="{% url 'bookshelf:book_list' %}">
        <input type="text" name="q" placeholder="Search books..." value="{{ search_query|default:'' }}" maxlength="100">
        <button type="submit">Search</button>
    </form>
    
    <ul>
        {% for book in books %}
        <li>
            {{ book.title }} by {{ book.author.name }} ({{ book.publication_year }})
            {% if perms.bookshelf.can_edit %}
            - <a href="{% url 'bookshelf:edit_book' book.id %}">Edit</a>
            {% endif %}
            {% if perms.bookshelf.can_delete %}
            - <form method="post" action="{% url 'bookshelf:delete_book' book.id %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" onclick="return confirm('Are you sure you want to delete {{ book.title|escapejs }}?')">Delete</button>
              </form>
            {% endif %}
        </li>
        {% empty %}
        <li>No books available.</li>
        {% endfor %}
    </ul>
    
    <p><a href="{% url 'bookshelf:dashboard' %}">Back to Dashboard</a></p>
</body>
</html>
